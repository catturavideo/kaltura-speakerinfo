(function(e){var t=['<div class="c-speaker-container">','<ul class="c-speaker-tabs">','<li><a href="#">Speaker</a></li>','<li><a href="#">Files</a></li>',"</ul>",'<div class="c-speaker-tab-content">',"<div>","<img>","<h3><small></small></h3>","<p></p>","</div>","<div>Loading...</div>","</div>","</div>"].join("");function a(e,t){if(!e)this.remove();else if(typeof t=="function")t.call(this);else this.html(t||e)}function n(e,a,n,i){var r=this,c=$(t);r.kdp=e;r.api=a;r.entry=n;r.config=r.parseXML(i);r.container=c;r.tabs=c.find(".c-speaker-tabs a");r.tab_content=c.find(".c-speaker-tab-content div");r.position(e.evaluate("{speakerInfo.widgetPosition}"));r.tabs.on("click",function(e){r.changeTab($(this).is(".c-active")&&-1||$.inArray(this,r.tabs));e.preventDefault()});$.each([r.speakerTab,r.filesTab],function(e,t){t.call(r,r.tab_content.eq(e))})}n.prototype={position:function(e){var t=this;switch(e){case"left":case"right":if(e=="left")$(t.kdp).before(t.container);else $(t.kdp).css("float","left").after(t.container);t.container.addClass("c-side").css("float","left");t.tab_content.parent().height($(t.kdp).height()-t.container.find(".c-speaker-tabs").outerHeight()-1);t.changeTab(0);break;default:$(t.kdp)[e=="bottom"?"after":"before"](t.container.width($(t.kdp).width()))}},parseXML:function(e){var t={},a=$($.parseXML(e));$.each(["Name","Email","Biography","Credentials","Image","Links","Rss","Files"],function(e,n){t[n]=a.find(n).text()});return t},changeTab:function(e){var t=this;t.tabs.removeClass("c-active");t.tab_content.hide();if(e!=-1){t.tabs.eq(e).addClass("c-active");t.tab_content.eq(e).show()}},removeTab:function(e){var t=this,a=$.inArray(e.get(0),t.tab_content);e.add(t.tabs.eq(a).parent()).remove()},speakerTab:function(t){var n=this,i=n.config;if(!i.Name)return n.removeTab(t);a.call(t.find("img"),i.Image,function(){this.attr("src",e.getKalturaThumbUrl({partner_id:n.kdp.evaluate("{configProxy.kw.partnerId}"),entry_id:i.Image,width:130,height:130})).attr("alt",i.Name)});t.find("h3").prepend(i.Name);a.call(t.find("h3 small"),i.Credentials);t.find("p").html(i.Biography.replace(/\n/g,"<br>"))},filesTab:function(e){var t=this;if(!t.config.Files)return t.removeTab(e);var a=$.grep(t.config.Files.split(","),function(e){return e.length>0}),n=$("<ul/>"),i;i=$.map(a,function(e){return{service:"attachment_attachmentasset",action:"get",attachmentAssetId:e}}).concat($.map(a,function(e){return{service:"attachment_attachmentasset",action:"getUrl",id:e}}));t.api.doRequest(i,function(t){for(var i=1;i<=a.length;i++){n.append($("<a/>",{text:t[i].title,href:t[i+a.length],target:"_blank"}).wrap("<li/>").parent())}n.appendTo(e.empty())})}};e.addReadyCallback(function(t){var a=document.getElementById(t),i=new e.api({wid:a.evaluate("{configProxy.kw.id}")}),r=a.evaluate("{mediaProxy.entry.id}");a.kBind("changeMedia.speakerInfo",function(){i.doRequest({service:"metadata_metadata",action:"list","filter:objectType":"KalturaMetadataFilter","filter:objectIdEqual":r},function(e){if(e=e&&e.objects&&e.objects[0])$(a).data("speaker",new n(a,i,r,e.xml))});a.kUnbind(".speakerInfo")})})})(kWidget);