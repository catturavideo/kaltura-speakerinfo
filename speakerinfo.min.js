(function(e){var t=['<div class="c-speaker-container">','<ul class="c-speaker-tabs">','<li><a href="#">Speaker</a></li>','<li><a href="#">Files</a></li>',"</ul>",'<div class="c-speaker-tab-content">',"<div>","<img>",'<h3><small></small><a class="c-speaker-email">E-mail</a></h3>',"<p></p>","</div>","<div>Loading...</div>","</div>","</div>"].join("");function a(e,t){if(!e)this.remove();else if(typeof t=="function")t.call(this);else this.html(t||e)}function i(e,a,i,n){var r=this,s=$(t);r.kdp=e;r.api=a;r.entry=i;r.config=r.parseXML(n);r.container=s;r.tabs=s.find(".c-speaker-tabs a");r.tab_content=s.find(".c-speaker-tab-content div");r.position(e.evaluate("{speakerInfo.widgetPosition}"));r.tabs.on("click",function(e){r.changeTab($(this).is(".c-active")&&-1||$.inArray(this,r.tabs));e.preventDefault()});$.each([r.speakerTab,r.filesTab],function(e,t){t.call(r,r.tab_content.eq(e))})}i.prototype={position:function(e){var t=this;switch(e){case"left":case"right":if(e=="left")$(t.kdp).before(t.container);else $(t.kdp).css("float","left").after(t.container);t.container.addClass("c-side").css("float","left");t.tab_content.parent().height($(t.kdp).height()-t.container.find(".c-speaker-tabs").outerHeight()-1);t.changeTab(0);t.side=true;break;default:$(t.kdp)[e=="bottom"?"after":"before"](t.container.width($(t.kdp).width()))}},parseXML:function(e){var t={},a=$($.parseXML(e));$.each(["Name","Email","Biography","Credentials","Image","Links","Rss","Files"],function(e,i){t[i]=a.find(i).text()});return t},changeTab:function(e){var t=this;t.tabs.removeClass("c-active");t.tab_content.hide();if(e!=-1){t.tabs.eq(e).addClass("c-active");t.tab_content.eq(e).show()}},removeTab:function(e){var t=this,a=$.inArray(e.get(0),t.tab_content);e.add(t.tabs.eq(a).parent()).remove()},speakerTab:function(t){var i=this,n=i.config;if(!n.Name)return i.removeTab(t);a.call(t.find("img"),n.Image,function(){this.attr("src",e.getKalturaThumbUrl({partner_id:i.kdp.evaluate("{configProxy.kw.partnerId}"),entry_id:n.Image,width:130,height:130})).attr("alt",n.Name)});t.find("h3").prepend(n.Name);a.call(t.find("h3 small"),n.Credentials);a.call(t.find("a"),n.Email,function(){this.attr("href","mailto:"+n.Email);if(!i.side)t.find("h3").after(this)});t.find("p").html(n.Biography.replace(/\n/g,"<br>"))},filesTab:function(e){var t=this,a=$("<ul/>");t.api.doRequest({service:"attachment_attachmentasset",action:"list","filter:entryIdEqual":t.entry},function(i){if(!i||!i.objects||!i.objects.length)return t.removeTab(e);i.objects.sort(function(e,t){return e.title.localeCompare(t.title)});t.api.doRequest($.map(i.objects,function(e){return{service:"attachment_attachmentasset",action:"getUrl",id:e.id}}),function(t){if(!$.isArray(t))t=[0,t];for(var n=1;n<t.length;n++){a.append($("<a/>",{text:i.objects[n-1].title,href:t[n],target:"_blank"}).wrap("<li/>").parent())}e.empty().append(a)})})}};e.addReadyCallback(function(t){var a=document.getElementById(t),n=new e.api({wid:a.evaluate("{configProxy.kw.id}")}),r=a.evaluate("{mediaProxy.entry.id}");a.kBind("changeMedia.speakerInfo",function(){n.doRequest({service:"metadata_metadata",action:"list","filter:objectType":"KalturaMetadataFilter","filter:objectIdEqual":r},function(e){if(e=e&&e.objects&&e.objects[0])$(a).data("speaker",new i(a,n,r,e.xml))});a.kUnbind(".speakerInfo")})})})(kWidget);