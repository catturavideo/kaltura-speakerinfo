(function(t){var e=['<div class="c-speaker-container">','<ul class="c-speaker-tabs">','<li><a href="#">Speaker</a></li>','<li><a href="#">Files</a></li>','<li><a href="#">Links</a></li>',"</ul>",'<div class="c-speaker-tab-content">',"<div>","<img>",'<h3><small></small><a class="c-speaker-email">E-mail</a></h3>',"<p></p>","</div>","<div>Loading...</div>","<div></div>","</div>","</div>"].join("");function a(t,e){if(!t)this.remove();else if(typeof e=="function")e.call(this);else this.html(e||t)}function i(t,a,i,n){var r=this,s=$(e);r.kdp=t;r.api=a;r.entry=i;r.config=r.parseXML(n);r.container=s;r.tabs=s.find(".c-speaker-tabs a");r.tab_content=s.find(".c-speaker-tab-content div");r.position(t.evaluate("{speakerInfo.widgetPosition}"));r.tabs.on("click",function(t){r.changeTab($(this).is(".c-active")&&-1||$.inArray(this,r.tabs));t.preventDefault()});$.each([r.speakerTab,r.filesTab,r.linksTab],function(t,e){e.call(r,r.tab_content.eq(t))})}i.prototype={position:function(t){var e=this;switch(t){case"left":case"right":if(t=="left")$(e.kdp).before(e.container);else $(e.kdp).css("float","left").after(e.container);e.container.addClass("c-side").css("float","left");e.tab_content.parent().height($(e.kdp).height()-e.container.find(".c-speaker-tabs").outerHeight()-1);e.changeTab(0);e.side=true;break;default:$(e.kdp)[t=="bottom"?"after":"before"](e.container.width($(e.kdp).width()))}},parseXML:function(t){var e={},a=$($.parseXML(t));$.each(["Name","Email","Biography","Credentials","Image"],function(t,i){e[i]=a.find(i).text()});e.Links=a.find("Links").map(function(){var t=$(this).text(),e=$.grep(["ftp://","http://","https://"],function(e){return t.indexOf(e)===0}).length>0;return e?t:"http://"+t}).get();return e},changeTab:function(t){var e=this;e.tabs.removeClass("c-active");e.tab_content.hide();if(t!=-1){e.tabs.eq(t).addClass("c-active");e.tab_content.eq(t).show()}},removeTab:function(t){var e=this,a=$.inArray(t.get(0),e.tab_content);t.add(e.tabs.eq(a).parent()).remove()},speakerTab:function(e){var i=this,n=i.config;if(!n.Name)return i.removeTab(e);a.call(e.find("img"),n.Image,function(){this.attr("src",t.getKalturaThumbUrl({partner_id:i.kdp.evaluate("{configProxy.kw.partnerId}"),entry_id:n.Image,width:130,height:130})).attr("alt",n.Name)});e.find("h3").prepend(n.Name);a.call(e.find("h3 small"),n.Credentials);a.call(e.find("a"),n.Email,function(){this.attr("href","mailto:"+n.Email);if(!i.side)e.find("h3").after(this)});e.find("p").html(n.Biography.replace(/\n/g,"<br>"))},filesTab:function(t){var e=this,a=$("<ul/>");e.api.doRequest({service:"attachment_attachmentasset",action:"list","filter:entryIdEqual":e.entry},function(i){if(!i||!i.objects||!i.objects.length)return e.removeTab(t);i.objects.sort(function(t,e){return t.title.localeCompare(e.title)});e.api.doRequest($.map(i.objects,function(t){return{service:"attachment_attachmentasset",action:"getUrl",id:t.id}}),function(e){if(!$.isArray(e))e=[0,e];for(var n=1;n<e.length;n++){a.append($("<a/>",{text:i.objects[n-1].title,href:e[n],target:"_blank"}).wrap("<li/>").parent())}t.empty().append(a)})})},linksTab:function(t){var e=this,a=$("<ul/>");if(!e.config.Links.length)e.removeTab(t);$.each(e.config.Links,function(t,e){a.append($("<a/>",{text:e,href:e,target:"_blank"}).wrap("<li/>").parent())});t.empty().append(a)}};t.addReadyCallback(function(e){var a=document.getElementById(e),n=new t.api({wid:a.evaluate("{configProxy.kw.id}")}),r=a.evaluate("{mediaProxy.entry.id}");a.kBind("changeMedia.speakerInfo",function(){n.doRequest({service:"metadata_metadata",action:"list","filter:objectType":"KalturaMetadataFilter","filter:objectIdEqual":r},function(t){if(t=t&&t.objects&&t.objects[0])$(a).data("speaker",new i(a,n,r,t.xml))});a.kUnbind(".speakerInfo")})})})(kWidget);