(function(e,t){var a=['<div class="c-speaker-container">','<ul class="c-speaker-tabs">','<li><a href="#">Speaker</a></li>','<li><a href="#">Files</a></li>','<li><a href="#">Links</a></li>',"</ul>",'<div class="c-speaker-tab-content">',"<div>","<img>",'<h3><small></small><a class="c-speaker-email">E-mail</a></h3>',"<p></p>","</div>","<div>Loading...</div>","<div></div>","</div>","</div>"].join("");function i(e,t){if(!e)this.remove();else if(typeof t=="function")t.call(this);else this.html(t||e)}function n(e,i,n,r){var s=this,c=t(a);s.kdp=e;s.api=i;s.entry=n;s.config=s.parseXML(r);s.container=c;s.tabs=c.find(".c-speaker-tabs a");s.tab_content=c.find(".c-speaker-tab-content div");s.position(e.evaluate("{speakerInfo.widgetPosition}"));s.tabs.on("click",function(e){s.changeTab(t(this).is(".c-active")&&-1||t.inArray(this,s.tabs));e.preventDefault()});t.each([s.speakerTab,s.filesTab,s.linksTab],function(e,t){t.call(s,s.tab_content.eq(e))})}n.prototype={position:function(e){var a=this;switch(e){case"left":case"right":if(e=="left")t(a.kdp).before(a.container);else t(a.kdp).css("float","left").after(a.container);a.container.addClass("c-side").css("float","left");a.tab_content.parent().height(t(a.kdp).height()-a.container.find(".c-speaker-tabs").outerHeight()-1);a.changeTab(0);a.side=true;break;default:t(a.kdp)[e=="bottom"?"after":"before"](a.container.width(t(a.kdp).width()))}},parseXML:function(e){var a={},i=t(t.parseXML(e));t.each(["Name","Email","Biography","Credentials","Image"],function(e,t){a[t]=i.find(t).text()});a.Links=i.find("Links").map(function(){var e=t(this).text(),a=t.grep(["ftp://","http://","https://"],function(t){return e.indexOf(t)===0}).length>0;return a?e:"http://"+e}).get();return a},changeTab:function(e){var t=this;t.tabs.removeClass("c-active");t.tab_content.hide();if(e!=-1){t.tabs.eq(e).addClass("c-active");t.tab_content.eq(e).show()}},removeTab:function(e){var a=this,i=t.inArray(e.get(0),a.tab_content);e.add(a.tabs.eq(i).parent()).remove()},speakerTab:function(t){var a=this,n=a.config;if(!n.Name)return a.removeTab(t);i.call(t.find("img"),n.Image,function(){this.attr("src",e.getKalturaThumbUrl({partner_id:a.kdp.evaluate("{configProxy.kw.partnerId}"),entry_id:n.Image,width:130,height:130})).attr("alt",n.Name)});t.find("h3").prepend(n.Name);i.call(t.find("h3 small"),n.Credentials);i.call(t.find("a"),n.Email,function(){this.attr("href","mailto:"+n.Email);if(!a.side)t.find("h3").after(this)});t.find("p").html(n.Biography.replace(/\n/g,"<br>"))},filesTab:function(e){var a=this,i=t("<ul/>");a.api.doRequest({service:"attachment_attachmentasset",action:"list","filter:entryIdEqual":a.entry},function(n){if(!n||!n.objects||!n.objects.length)return a.removeTab(e);n.objects.sort(function(e,t){return e.title.localeCompare(t.title)});a.api.doRequest(t.map(n.objects,function(e){return{service:"attachment_attachmentasset",action:"getUrl",id:e.id}}),function(a){if(!t.isArray(a))a=[0,a];for(var r=1;r<a.length;r++){i.append(t("<a/>",{text:n.objects[r-1].title,href:a[r],target:"_blank"}).wrap("<li/>").parent())}e.empty().append(i)})})},linksTab:function(e){var a=this,i=t("<ul/>");if(!a.config.Links.length)a.removeTab(e);t.each(a.config.Links,function(e,a){i.append(t("<a/>",{text:a,href:a,target:"_blank"}).wrap("<li/>").parent())});e.empty().append(i)}};e.addReadyCallback(function(a){var i=document.getElementById(a),r=new e.api({wid:i.evaluate("{configProxy.kw.id}")}),s=i.evaluate("{mediaProxy.entry.id}");i.kBind("changeMedia.speakerInfo",function(){r.doRequest({service:"metadata_metadata",action:"list","filter:objectType":"KalturaMetadataFilter","filter:objectIdEqual":s},function(e){if(e=e&&e.objects&&e.objects[0])t(i).data("speaker",new n(i,r,s,e.xml))});i.kUnbind(".speakerInfo")})})})(kWidget,jQuery);